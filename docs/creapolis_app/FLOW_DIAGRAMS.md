# 🎬 Flujo de Usuario - Widgets Personalizables

## Flujo 1: Personalizar Dashboard Existente

```
┌─────────────────────────────────────────────────┐
│  1. Usuario ve Dashboard con widgets default   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ Dashboard                               │   │
│  │ [Personalizar] [🔔] [👤]               │   │
│  │                                         │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🏢 Workspace Info                   │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📊 Quick Stats                      │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ⚡ Quick Actions                    │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                      ↓
                   Click en
                "Personalizar"
                      ↓
┌─────────────────────────────────────────────────┐
│  2. Modo Edición Activado                      │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ Dashboard                               │   │
│  │ [✓ Guardar] [↺ Reset] [🔔] [👤]       │   │
│  │                                         │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🏢 Workspace [☰] [✕]               │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │      ↕️ (draggable)                    │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📊 Quick Stats [☰] [✕]             │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │      ↕️ (draggable)                    │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ⚡ Quick Actions [☰] [✕]           │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │                                         │   │
│  │                      ┌────────────────┐ │   │
│  │                      │ ➕ Añadir      │ │   │
│  │                      │   Widget       │ │   │
│  │                      └────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
```

## Flujo 2: Reordenar Widgets

```
┌─────────────────────────────────────────────────┐
│  1. Usuario arrastra widget                    │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🏢 Workspace [☰] [✕]               │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │                                         │   │
│  │    👆 Usuario comienza a arrastrar     │   │
│  │      ↕️                                 │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📊 Quick Stats [☰] [✕]             │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │                                         │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ⚡ Quick Actions [☰] [✕]           │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                      ↓
                Widget se eleva
              (visual feedback)
                      ↓
┌─────────────────────────────────────────────────┐
│  2. Arrastrando...                             │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📊 Quick Stats [☰] [✕]             │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │                                         │   │
│  │      ┌───────────────────────────────┐  │   │
│  │      │ 🏢 Workspace [☰] [✕]         │  │   │
│  │      │ (elevation: 8, opacity: 0.8) │  │   │
│  │      └───────────────────────────────┘  │   │
│  │             👆 cursor                   │   │
│  │                                         │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ⚡ Quick Actions [☰] [✕]           │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                      ↓
               Usuario suelta
                      ↓
┌─────────────────────────────────────────────────┐
│  3. Nuevo orden aplicado                       │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📊 Quick Stats [☰] [✕]             │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🏢 Workspace [☰] [✕]               │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ⚡ Quick Actions [☰] [✕]           │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ℹ️  Click "Guardar" para persistir cambios   │
└─────────────────────────────────────────────────┘
```

## Flujo 3: Añadir Widget Nuevo

```
┌─────────────────────────────────────────────────┐
│  1. En modo edición, click en FAB              │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ Dashboard (Modo Edición)                │   │
│  │                                         │   │
│  │ (widgets actuales...)                   │   │
│  │                                         │   │
│  │                                         │   │
│  │                      ┌────────────────┐ │   │
│  │                      │ ➕ Añadir      │ │   │
│  │                      │   Widget       │ │   │
│  │                      └────────────────┘ │   │
│  │                         👆 Click        │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                      ↓
              Bottom sheet aparece
                 (slide up)
                      ↓
┌─────────────────────────────────────────────────┐
│  2. Seleccionar widget de la lista             │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │        ──── (drag handle)               │   │
│  │                                         │   │
│  │  ➕ Añadir Widget                [✕]   │   │
│  │  ────────────────────────────────────  │   │
│  │                                         │   │
│  │  ┌───────────────────────────────────┐ │   │
│  │  │ [✓] Mis Tareas                 → │ │   │
│  │  │     Lista de tus tareas activas   │ │   │
│  │  └───────────────────────────────────┘ │   │
│  │       👆 Usuario selecciona            │   │
│  │                                         │   │
│  │  ┌───────────────────────────────────┐ │   │
│  │  │ [📁] Mis Proyectos             → │ │   │
│  │  │     Lista de proyectos recientes  │ │   │
│  │  └───────────────────────────────────┘ │   │
│  │                                         │   │
│  │  ┌───────────────────────────────────┐ │   │
│  │  │ [🕐] Actividad Reciente        → │ │   │
│  │  │     Actividad en tus proyectos    │ │   │
│  │  └───────────────────────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                      ↓
              Widget seleccionado
                      ↓
┌─────────────────────────────────────────────────┐
│  3. Widget añadido al final del dashboard      │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ Dashboard (Modo Edición)                │   │
│  │                                         │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📊 Quick Stats [☰] [✕]             │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🏢 Workspace [☰] [✕]               │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ⚡ Quick Actions [☰] [✕]           │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ✓ Mis Tareas [☰] [✕]      ← NUEVO │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │            (slide in animation)         │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ✅ Widget "Mis Tareas" añadido                │
└─────────────────────────────────────────────────┘
```

## Flujo 4: Eliminar Widget

```
┌─────────────────────────────────────────────────┐
│  1. Hover sobre widget en modo edición         │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📊 Quick Stats         [☰] [✕]     │ │   │
│  │ │                          ↑  ↑       │ │   │
│  │ │                    visible on hover │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │                                         │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🏢 Workspace                        │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                      ↓
              Click en [✕]
                      ↓
┌─────────────────────────────────────────────────┐
│  2. Widget eliminado (fade out)                │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📊 Quick Stats                      │ │   │
│  │ │ (fading out + scaling down...)      │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │                                         │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🏢 Workspace                        │ │   │
│  │ │ (moving up...)                      │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                      ↓
                   300ms
                      ↓
┌─────────────────────────────────────────────────┐
│  3. Lista reordenada automáticamente           │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🏢 Workspace [☰] [✕]               │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ⚡ Quick Actions [☰] [✕]           │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │                                         │   │
│  │                      ┌────────────────┐ │   │
│  │                      │ ➕ Añadir      │ │   │
│  │                      │   Widget       │ │   │
│  │                      └────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ✅ Widget eliminado                           │
└─────────────────────────────────────────────────┘
```

## Flujo 5: Resetear Configuración

```
┌─────────────────────────────────────────────────┐
│  1. En modo edición, click en "Reset"          │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ Dashboard                               │   │
│  │ [✓ Guardar] [↺ Reset] [🔔] [👤]       │   │
│  │                  ↑                      │   │
│  │            Click aquí                   │   │
│  │                                         │   │
│  │ (widgets personalizados...)             │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                      ↓
              Diálogo aparece
                      ↓
┌─────────────────────────────────────────────────┐
│  2. Confirmación de reset                      │
│                                                 │
│         ┌─────────────────────────────┐        │
│         │ Resetear Configuración      │        │
│         ├─────────────────────────────┤        │
│         │                             │        │
│         │ ¿Estás seguro de que        │        │
│         │ quieres restaurar la        │        │
│         │ configuración por defecto   │        │
│         │ del dashboard?              │        │
│         │                             │        │
│         ├─────────────────────────────┤        │
│         │ [Cancelar]    [Resetear]    │        │
│         └─────────────────────────────┘        │
│                               ↑                 │
│                         Click aquí              │
└─────────────────────────────────────────────────┘
                      ↓
               Confirmado
                      ↓
┌─────────────────────────────────────────────────┐
│  3. Dashboard reseteado a configuración default│
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ Dashboard                               │   │
│  │ [Personalizar] [🔔] [👤]               │   │
│  │                                         │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🏢 Workspace Info                   │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📊 Quick Stats                      │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ⚡ Quick Actions                    │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ ✓ My Tasks                          │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 📁 My Projects                      │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ 🕐 Recent Activity                  │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ✅ Configuración reseteada                    │
│  Modo edición: OFF                             │
└─────────────────────────────────────────────────┘
```

## Flujo 6: Persistencia entre Sesiones

```
┌─────────────────────────────────────────────────┐
│  Sesión 1: Usuario personaliza dashboard       │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ 1. Reordena widgets                     │   │
│  │ 2. Elimina "Quick Actions"              │   │
│  │ 3. Añade "Recent Activity"              │   │
│  │ 4. Click "Guardar"                      │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│                    ↓                            │
│                                                 │
│         DashboardPreferencesService             │
│         saveDashboardConfig()                   │
│                    ↓                            │
│         SharedPreferences                       │
│         (JSON guardado en disco)                │
│                                                 │
└─────────────────────────────────────────────────┘

           Usuario cierra app
                  ...
           Usuario reabre app

┌─────────────────────────────────────────────────┐
│  Sesión 2: Configuración persiste              │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ main.dart                               │   │
│  │   └─> DashboardPreferencesService       │   │
│  │       .instance.init()                  │   │
│  └─────────────────────────────────────────┘   │
│                    ↓                            │
│  ┌─────────────────────────────────────────┐   │
│  │ DashboardScreen.initState()             │   │
│  │   └─> _loadConfiguration()              │   │
│  │       └─> getDashboardConfig()          │   │
│  └─────────────────────────────────────────┘   │
│                    ↓                            │
│         SharedPreferences                       │
│         (carga JSON guardado)                   │
│                    ↓                            │
│  ┌─────────────────────────────────────────┐   │
│  │ Dashboard renderiza con                 │   │
│  │ configuración personalizada del usuario │   │
│  │                                         │   │
│  │ ✅ Mismo orden                          │   │
│  │ ✅ Mismos widgets                       │   │
│  │ ✅ "Quick Actions" ausente              │   │
│  │ ✅ "Recent Activity" presente           │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
```

## Tiempos de Animación

- **Slide in (añadir)**: 400ms
- **Fade out (eliminar)**: 300ms
- **Reordenar**: 300ms
- **Bottom sheet**: 300ms
- **Hover effects**: 200ms
- **Mode toggle**: 200ms

## Gestos Soportados

- **Click**: Seleccionar, confirmar, cancelar
- **Long Press**: Iniciar drag (alternativa a handle)
- **Drag & Drop**: Reordenar widgets
- **Swipe Down**: Cerrar bottom sheet
- **Pull to Refresh**: Recargar datos (modo normal)

## Estados de Loading

Mientras se guarda/carga configuración:
- Botones deshabilitados
- Cursor: progress
- Opcional: Overlay semitransparente con spinner
